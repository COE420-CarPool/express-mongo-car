<!DOCTYPE html>
<html>
<head>
  <title>My First Node App</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div class="container">
    
    <div id="messages">

    </div>
</div>
<script>

   var socket = io();
    $(() => {
       
      
        getMessages()
    })

    socket.on('message', addMessages)
    socket.on('message', requestMatch)

    function addMessages(message){

      //  var clicker = "ID" + Math.random().toString(16).slice(2)
     
        var clicky = message._id
        $("#messages").append(`
        
        <h4>Going to ${message.destination}</h4> 
        <p> Current Seat Capacity: ${message.seats} </p>
        <p> Departure time: ${message.departure} </p>
        <p> Meeting Point: ${message.pickup} </p>
        <p> Car Plate Number: ${message.platenum} </p>
        <p> Driver's message:${message.message} </p>
        <p> Posted at:  ${message.time} </p>
        <p> Posted by:  ${message.creator_name} </p>
        <p> Posted by (email):  ${message.creator_email} </p>
        <p> Posted by (phone):  ${message.creator_phone} </p>
        <button id="${clicky}" class="btn btn-success">${message._id}</button>
       
        
        `)
    
        
      //  $("#messages").querySelector(`div[id="${message._id}"] > button`)
       // .addEventListener('click', () =>  console.log(message._id))
         
       /* function func(){
        $('#messages').on('click','clicker', function () {
           console.log(clicker)
         requestMatch(message)
        });
        }*/
        const findDrive =  document.querySelector(`[id="${clicky}"]`);
        findDrive.addEventListener('click', e => { 
          console.log(`Requesting --> ${message._id}`    );
          requestMatch(message)
  });

    setTimeout(addMessages, 1000);
    }

   
    //$("#match").click(()=>{console.log("CLICK TO MATCHHHHH")})
    
    function requestMatch(message) {
        $.post('http://localhost:9999/requestMatch', message)
    }

    function getMessages(){
      $.get('http://localhost:9999/messages', (data) => {
        data.forEach(addMessages);
        for (i = 0; i < data.length; i++) {
        console.log(data[i])


}
      })
    }

    function sendMessage(message){
      $.post('http://localhost:9999/messages', message)
    }

</script>
</body>
</html>
